# for_dhcp
Основная задача, которую решает проект: назначение ip адресов по заданному mac адресу в локальной сети через веб-интерфейс.
В данном web проекте реализованы следующие возможности:
1) Выдача ip адресов по известным mac адресам для сетевых устройств в локальной сети. После редактирования полей через веб-интрефейс, в каталоге result генерируется файл dhcpd.hosts, который содержит связки ip_address - mac_address, а так же необходимые комментарии. 
2) Доступ в интернет для хостов по ip адресу. Редактируя поле "user_access" можно установить значения 0-3. После завершения редактирования в каталоге result генерируются файлы proxy1, proxy2, proxy3
3) Фильтрацию полей хостов по поступившему номеру телефонного звонка (caller_id). Сайт принимает get запросы вида http://<your_ip>:8000/set_call/<integer_phone_number> . Клиент опрашивает сервер по ajax с таймером 5 секунд получает последний звонок и выводит записи в случае совпадения. Таким образом, в реальном режиме времени можно видеть с какого номера и из какого кабинета был осуществлен звонок.

Описание.
После создания и редактирования записи в каталоге result вы можете видеть файлы dhcpd.hosts, proxy1, proxy2, proxy3. При использовании популярного dhcp сервера isc-dhcp-server, вы можете поместить файл dhcpd.hosts в конфигурационный каталог dhcp и добавив в файл основного конфига строку include "/etc/dhcp/dhcpd.hosts"; , выполнить релоад службы и получить новую работающую конфигурацию. Аналогично можно поступить с файлами proxy* для прокси сервера. Автоматизировать решение такой задачи возможно путем создания 
сервис юнита (при использовании системы инициализации systemd) запускающего скрипт при изменении файлов каталога. Подобный скрипт также можно запустить через python subprocess( подключившись к контейнеру вы можете посмотреть образец в модуле route.py .Этот код закомментирован. Скрипт не приложен, чтобы не открывать вам структуру файловой системы серевера, однако операции тривиальны: копирование с заменой файлов в нужные каталоги, установка владельца на файлы, проверка синтаксиса, релоад служб). Разрешение на выполнение и только выполнение скрипта непривилегированным  пользователем от имени которого запущен веб сервер можно установить через sudoers.
При наличии программной АТС (asterisk и т.п) вы можете написать скрипт, который в момент звонка на телефонный номер техподдержки, берет номер звонящего (caller_id) и посылает get запрос http://<your_ip>:8000/set_call/<integer_phone_number> . 
Пример на asterisk: 
Файл extention_custom
`;exten => <support_number>,1,System(<path_to_script.sh>${CALLERID(num)} &)
;exten => <support_number>,n,Goto(from-queue-exten-only,${EXTEN},1)`
Файл скрипта path_to_script.sh:
`wget http://webdhcp.niipp.ru/set_call/$1`

Последовательность действий при установке:(ниже, в пункте "Команды" будет приведена последовательность команд)
1) Склонируйте репозиторий github.com/vikvikst/for_dhcp.git на локальную машину и войдите в каталог for_dhcp
2) Задайте владельца директории result пользователя root рекурсивно
3) Загрузите docker образ vikvikst/for_dhcp
4) Соберите и запустите контейнер от пользователя root на удобном для вас порту, гуникорн слушает 5000

 Команды:
 git clone https://github.com/vikvikst/for_dhcp.git
 cd for_dhcp
 docker pull vikvikst/for_dhcp
 docker run -v $(pwd)/result:/for_dhcp/result --name for_dhcp -d -p 8000:5000 vikvikst/for_dhcp

 Образ предназначен исключительно для демонстрации.
 Используется монтирование каталога с хоста bind mount и запуск под рутом. Безопасным вариантом было бы создание в docker образе пользователя с заданным id, 
 однако в этом случае пользователю пришлось бы выплнить лишние действия по добавлению нового пользователя с аналогичным id в систему хоста.

 В веб-интерфейсе сайте есть документация пользователя: Меню(иконка справа) -> документация пользователя 



 

 

